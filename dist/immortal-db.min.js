/*! For license information please see immortal-db.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ImmortalDB=t():e.ImmortalDB=t()}(self,(()=>(()=>{var e={808:(e,t,r)=>{var o,s;!function(n){if(void 0===(s="function"==typeof(o=n)?o.call(t,r,t,e):o)||(e.exports=s),!0,e.exports=n(),!!0){var i=window.Cookies,a=window.Cookies=n();a.noConflict=function(){return window.Cookies=i,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var o in r)t[o]=r[o]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(o){function s(){}function n(t,r,n){if("undefined"!=typeof document){"number"==typeof(n=e({path:"/"},s.defaults,n)).expires&&(n.expires=new Date(1*new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var i=JSON.stringify(r);/^[\{\[]/.test(i)&&(r=i)}catch(e){}r=o.write?o.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in n)n[c]&&(a+="; "+c,!0!==n[c]&&(a+="="+n[c].split(";")[0]));return document.cookie=t+"="+r+a}}function i(e,r){if("undefined"!=typeof document){for(var s={},n=document.cookie?document.cookie.split("; "):[],i=0;i<n.length;i++){var a=n[i].split("="),c=a.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(a[0]);if(c=(o.read||o)(c,l)||t(c),r)try{c=JSON.parse(c)}catch(e){}if(s[l]=c,e===l)break}catch(e){}}return e?s[e]:s}}return s.set=n,s.get=function(e){return i(e,!1)},s.getJSON=function(e){return i(e,!0)},s.remove=function(t,r){n(t,"",e(r,{expires:-1}))},s.defaults={},s.withConverter=r,s}((function(){}))}))}},t={};function r(o){var s=t[o];if(void 0!==s)return s.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{"use strict";r.r(o),r.d(o,{CookieStore:()=>m,DEFAULT_DATABASE_NAME:()=>w,DEFAULT_KEY_PREFIX:()=>b,DEFAULT_STORES:()=>I,DEFAULT_STORE_NAME:()=>y,DEFAULT_VALUE:()=>x,ImmortalDecoderError:()=>s,ImmortalEncoderError:()=>t,ImmortalError:()=>e,ImmortalStorage:()=>j,ImmortalStoresPartialError:()=>n,ImmortalStoresTotalError:()=>i,IndexedDbStore:()=>S,LocalStorageStore:()=>v,SessionStorageStore:()=>E});class e extends Error{constructor(e="ImmortalDB unexpected error"){super(e),this.name="ImmortalError"}}class t extends e{constructor(e="Unable to encode the value to be stored"){super(e),this.name="ImmortalEncoderError"}}class s extends e{constructor(e="Unable to decode the stored value"){super(e),this.name="ImmortalDecoderError"}}class n extends e{constructor(e="Some stores failed to perform operation"){super(e),this.name="ImmortalStoresPartialError"}}class i extends e{constructor(e="All stores failed to perform operation"){super(e),this.name="ImmortalStoresPartialError"}}var a=r(808),c=r.n(a);const l=function(){try{return!window.top.location.href}catch(e){return!0}}(),u=!!l,d=l?"None":"Lax";class m{constructor({ttl:e=365,secure:t=u,sameSite:r=d}={}){return this.ttl=e,this.secure=t,this.sameSite=r,(async()=>this)()}async get(e){const t=c().get(e);return"string"==typeof t?t:void 0}async set(e,t){c().set(e,t,this._constructCookieParams())}async remove(e){c().remove(e,this._constructCookieParams())}_constructCookieParams(){return{expires:this.ttl,secure:this.secure,sameSite:this.sameSite}}}class f{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise(((r,o)=>{const s=indexedDB.open(e,1);s.onerror=()=>o(s.error),s.onsuccess=()=>r(s.result),s.onupgradeneeded=()=>{s.result.createObjectStore(t)}}))}_withIDBStore(e,t){return this._dbp.then((r=>new Promise(((o,s)=>{const n=r.transaction(this.storeName,e);n.oncomplete=()=>o(),n.onabort=n.onerror=()=>s(n.error),t(n.objectStore(this.storeName))}))))}}let h;function p(){return h||(h=new f),h}const w="ImmortalDB",y="key-value-pairs";class S{constructor(e=w,t=y){return this.store=new f(e,t),(async()=>{try{await this.store._dbp}catch(e){if("SecurityError"===e.name)return null;throw e}return this})()}async get(e){const t=await function(e,t=p()){let r;return t._withIDBStore("readonly",(t=>{r=t.get(e)})).then((()=>r.result))}(e,this.store);return"string"==typeof t?t:void 0}async set(e,t){await function(e,t,r=p()){return r._withIDBStore("readwrite",(r=>{r.put(t,e)}))}(e,t,this.store)}async remove(e){await function(e,t=p()){return t._withIDBStore("readwrite",(t=>{t.delete(e)}))}(e,this.store)}}class g{constructor(e){return this.store=e,(async()=>this)()}async get(e){const t=this.store.getItem(e);return"string"==typeof t?t:void 0}async set(e,t){this.store.setItem(e,t)}async remove(e){this.store.removeItem(e)}}class v extends g{constructor(){super(window.localStorage)}}class E extends g{constructor(){super(window.sessionStorage)}}const x=void 0,b="_immortal|",I=[m],P=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}();try{P&&P.indexedDB&&I.push(S)}catch(e){}try{P&&P.localStorage&&I.push(v)}catch(e){}const _="fulfilled",D=e=>e;class j{constructor(e=I,t=b,r=x,o=D,s=D){this.encoder=o||D,this.decoder=s||D,this.defaultValue=r,this.keyPrefix=t??b,this.stores=[],this.onReady=(async()=>{const t=await Promise.allSettled(e.map((e=>{if("function"!=typeof e)return e;try{return new e}catch(e){return Promise.reject(e)}})));return this.stores=t.filter((e=>e.status===_)).map((e=>e.value)).filter((e=>e)),0===this.stores.length?Promise.reject(new Error("Unable to construct any store")):Promise.resolve()})()}_createErrorFromSettledPromises(e,t){const r=e.filter((e=>"rejected"===e.status)).map((e=>e.reason instanceof Error?e.reason.message:String(e.reason)));if(r.length>0){const e=this.stores.length===r.length,o=[`${e?"All":"Some"} stores failed to ${t}(). Store errors:`,...r.map((e=>`    * "${e}"`))].join("\n");return new(e?i:n)(o)}}prefix(e){return`${this.keyPrefix}${e}`}async get(e,r=this.defaultValue){await this.onReady;const o=this.prefix(e),n=await Promise.allSettled(this.stores.map((e=>e.get(o)))),i=function(e){let t=0;const r=Object.create(null);e.forEach((e=>{if(null==e)return void(t+=1);const o=r[e]||0;r[e]=o+1}));const o=Object.entries(r);return t&&o.push([void 0,t]),o}(n.filter((e=>e.status===_)).map((e=>e.value)));i.sort(((e,t)=>e[1]<=t[1]));const a=i.filter((([e])=>void 0!==e));if(0===a.length){return this._createErrorFromSettledPromises(n,"get")||await this.remove(e),r}const[c]=a[0];let l;try{l=await this.decoder(c)}catch(e){throw new s}try{await this.set(e,l)}catch(e){if(e instanceof t)throw e}return l}async set(e,r){await this.onReady;const o=this.prefix(e);let s;try{s=await this.encoder(r)}catch(e){throw new t}const n=await Promise.allSettled(this.stores.map((e=>e.set(o,s)))),i=this._createErrorFromSettledPromises(n,"set");if(i)throw i;const a=await Promise.allSettled(this.stores.map((e=>e.get(o).then((e=>{if(e&&e!==s)return Promise.reject(new Error("Integrity check failed"))}))))),c=this._createErrorFromSettledPromises(a,"set");if(c)throw c;return r}async remove(e){await this.onReady;const t=this.prefix(e),r=await Promise.allSettled(this.stores.map((e=>e.remove(t)))),o=this._createErrorFromSettledPromises(r,"remove");if(o)throw o;return this.defaultValue}}})(),o})()));