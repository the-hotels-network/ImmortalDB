/*! For license information please see immortal-db.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ImmortalDB=t():e.ImmortalDB=t()}(self,(()=>(()=>{var e={808:(e,t,r)=>{var o,n;!function(s){if(void 0===(n="function"==typeof(o=s)?o.call(t,r,t,e):o)||(e.exports=n),!0,e.exports=s(),!!0){var i=window.Cookies,a=window.Cookies=s();a.noConflict=function(){return window.Cookies=i,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var o in r)t[o]=r[o]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(o){function n(){}function s(t,r,s){if("undefined"!=typeof document){"number"==typeof(s=e({path:"/"},n.defaults,s)).expires&&(s.expires=new Date(1*new Date+864e5*s.expires)),s.expires=s.expires?s.expires.toUTCString():"";try{var i=JSON.stringify(r);/^[\{\[]/.test(i)&&(r=i)}catch(e){}r=o.write?o.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in s)s[c]&&(a+="; "+c,!0!==s[c]&&(a+="="+s[c].split(";")[0]));return document.cookie=t+"="+r+a}}function i(e,r){if("undefined"!=typeof document){for(var n={},s=document.cookie?document.cookie.split("; "):[],i=0;i<s.length;i++){var a=s[i].split("="),c=a.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=t(a[0]);if(c=(o.read||o)(c,u)||t(c),r)try{c=JSON.parse(c)}catch(e){}if(n[u]=c,e===u)break}catch(e){}}return e?n[e]:n}}return n.set=s,n.get=function(e){return i(e,!1)},n.getJSON=function(e){return i(e,!0)},n.remove=function(t,r){s(t,"",e(r,{expires:-1}))},n.defaults={},n.withConverter=r,n}((function(){}))}))}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{"use strict";r.r(o),r.d(o,{CookieStore:()=>a,DEFAULT_KEY_PREFIX:()=>m,DEFAULT_STORES:()=>y,ImmortalDB:()=>x,ImmortalStorage:()=>b,IndexedDbStore:()=>f,LocalStorageStore:()=>h,SessionStorageStore:()=>p});var e=r(808),t=r.n(e);const n=function(){try{return!window.top.location.href}catch(e){return!0}}(),s=!!n,i=n?"None":"Lax";class a{constructor({ttl:e=365,secure:t=s,sameSite:r=i}={}){return this.ttl=e,this.secure=t,this.sameSite=r,(async()=>this)()}async get(e){const r=t().get(e);return"string"==typeof r?r:void 0}async set(e,r){t().set(e,r,this._constructCookieParams())}async remove(e){t().remove(e,this._constructCookieParams())}_constructCookieParams(){return{expires:this.ttl,secure:this.secure,sameSite:this.sameSite}}}class c{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise(((r,o)=>{const n=indexedDB.open(e,1);n.onerror=()=>o(n.error),n.onsuccess=()=>r(n.result),n.onupgradeneeded=()=>{n.result.createObjectStore(t)}}))}_withIDBStore(e,t){return this._dbp.then((r=>new Promise(((o,n)=>{const s=r.transaction(this.storeName,e);s.oncomplete=()=>o(),s.onabort=s.onerror=()=>n(s.error),t(s.objectStore(this.storeName))}))))}}let u;function l(){return u||(u=new c),u}class f{constructor(e="ImmortalDB",t="key-value-pairs"){return this.store=new c(e,t),(async()=>{try{await this.store._dbp}catch(e){if("SecurityError"===e.name)return null;throw e}return this})()}async get(e){const t=await function(e,t=l()){let r;return t._withIDBStore("readonly",(t=>{r=t.get(e)})).then((()=>r.result))}(e,this.store);return"string"==typeof t?t:void 0}async set(e,t){await function(e,t,r=l()){return r._withIDBStore("readwrite",(r=>{r.put(t,e)}))}(e,t,this.store)}async remove(e){await function(e,t=l()){return t._withIDBStore("readwrite",(t=>{t.delete(e)}))}(e,this.store)}}class d{constructor(e){return this.store=e,(async()=>this)()}async get(e){const t=this.store.getItem(e);return"string"==typeof t?t:void 0}async set(e,t){this.store.setItem(e,t)}async remove(e){this.store.removeItem(e)}}class h extends d{constructor(){super(window.localStorage)}}class p extends d{constructor(){super(window.sessionStorage)}}const m="_immortal|",y=[a],w=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}();try{w&&w.indexedDB&&y.push(f)}catch(e){}try{w&&w.localStorage&&y.push(h)}catch(e){}const g="fulfilled",v="rejected",S=e=>e;class b{constructor(e=y,t=m,r,o=S,n=S){this.encoder=o||S,this.decoder=n||S,this.defaultValue=r,this.keyPrefix=t??m,this.stores=[],this.onReady=(async()=>{const t=await Promise.allSettled(e.map((e=>{if("function"!=typeof e)return e;try{return new e}catch(e){return Promise.reject(e)}})));return this.stores=t.filter((e=>e.status===g)).map((e=>e.value)).filter((e=>e)),0===this.stores.length?Promise.reject(new Error("Unable to construct any store")):Promise.resolve()})()}prefix(e){return`${this.keyPrefix}${e}`}async get(e,t=this.defaultValue){await this.onReady;const r=this.prefix(e),o=await Promise.allSettled(this.stores.map((e=>e.get(r).then((e=>e&&this.decoder(e)))))),n=function(e){let t=0;const r=Object.create(null);e.forEach((e=>{if(null==e)return void(t+=1);const o=r[e]||0;r[e]=o+1}));const o=Object.entries(r);return t&&o.push([void 0,t]),o}(o.filter((e=>e.status===g)).map((e=>e.value)));n.sort(((e,t)=>e[1]<=t[1]));const s=n.filter((([e])=>void 0!==e));if(0===s.length){return 0===o.filter((e=>e.status===v)).length&&await this.remove(e),t}const[i]=s[0];try{await this.set(e,i)}catch(e){}return i}async set(e,t){await this.onReady;const r=this.prefix(e),o=await Promise.resolve(this.encoder(t)),n=await Promise.allSettled(this.stores.map((e=>e.set(r,o)))),s=n.filter((e=>e.status===v));if(s.length>0){const r=this.stores.length===s.length;throw new Error(`${r?"All":"Some"} stores failed to set('${e}', '${t}')`)}return t}async remove(e){await this.onReady;const t=this.prefix(e),r=await Promise.allSettled(this.stores.map((e=>e.remove(t)))),o=r.filter((e=>e.status===v));if(o.length>0){const t=this.stores.length===o.length;throw new Error(`${t?"All":"Some"} stores failed to remove('${e}')`)}return this.defaultValue}}const x=new b})(),o})()));