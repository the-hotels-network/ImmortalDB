/*! For license information please see immortal-db.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ImmortalDB=t():e.ImmortalDB=t()}(self,(()=>(()=>{var e={808:(e,t,r)=>{var o,n;!function(s){if(void 0===(n="function"==typeof(o=s)?o.call(t,r,t,e):o)||(e.exports=n),!0,e.exports=s(),!!0){var i=window.Cookies,a=window.Cookies=s();a.noConflict=function(){return window.Cookies=i,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var o in r)t[o]=r[o]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(o){function n(){}function s(t,r,s){if("undefined"!=typeof document){"number"==typeof(s=e({path:"/"},n.defaults,s)).expires&&(s.expires=new Date(1*new Date+864e5*s.expires)),s.expires=s.expires?s.expires.toUTCString():"";try{var i=JSON.stringify(r);/^[\{\[]/.test(i)&&(r=i)}catch(e){}r=o.write?o.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in s)s[c]&&(a+="; "+c,!0!==s[c]&&(a+="="+s[c].split(";")[0]));return document.cookie=t+"="+r+a}}function i(e,r){if("undefined"!=typeof document){for(var n={},s=document.cookie?document.cookie.split("; "):[],i=0;i<s.length;i++){var a=s[i].split("="),c=a.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var u=t(a[0]);if(c=(o.read||o)(c,u)||t(c),r)try{c=JSON.parse(c)}catch(e){}if(n[u]=c,e===u)break}catch(e){}}return e?n[e]:n}}return n.set=s,n.get=function(e){return i(e,!1)},n.getJSON=function(e){return i(e,!0)},n.remove=function(t,r){s(t,"",e(r,{expires:-1}))},n.defaults={},n.withConverter=r,n}((function(){}))}))}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{"use strict";r.r(o),r.d(o,{CookieStore:()=>u,DEFAULT_DATABASE_NAME:()=>h,DEFAULT_KEY_PREFIX:()=>S,DEFAULT_STORES:()=>b,DEFAULT_STORE_NAME:()=>p,DEFAULT_VALUE:()=>v,ImmortalDecoderError:()=>t,ImmortalEncoderError:()=>e,ImmortalStorage:()=>I,IndexedDbStore:()=>m,LocalStorageStore:()=>y,SessionStorageStore:()=>g});class e extends Error{constructor(e="Unable to encode the value to be stored"){super(e),this.name="ImmortalEncoderError"}}class t extends Error{constructor(e="Unable to decode the stored value"){super(e),this.name="ImmortalDecoderError"}}var n=r(808),s=r.n(n);const i=function(){try{return!window.top.location.href}catch(e){return!0}}(),a=!!i,c=i?"None":"Lax";class u{constructor({ttl:e=365,secure:t=a,sameSite:r=c}={}){return this.ttl=e,this.secure=t,this.sameSite=r,(async()=>this)()}async get(e){const t=s().get(e);return"string"==typeof t?t:void 0}async set(e,t){s().set(e,t,this._constructCookieParams())}async remove(e){s().remove(e,this._constructCookieParams())}_constructCookieParams(){return{expires:this.ttl,secure:this.secure,sameSite:this.sameSite}}}class l{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise(((r,o)=>{const n=indexedDB.open(e,1);n.onerror=()=>o(n.error),n.onsuccess=()=>r(n.result),n.onupgradeneeded=()=>{n.result.createObjectStore(t)}}))}_withIDBStore(e,t){return this._dbp.then((r=>new Promise(((o,n)=>{const s=r.transaction(this.storeName,e);s.oncomplete=()=>o(),s.onabort=s.onerror=()=>n(s.error),t(s.objectStore(this.storeName))}))))}}let d;function f(){return d||(d=new l),d}const h="ImmortalDB",p="key-value-pairs";class m{constructor(e=h,t=p){return this.store=new l(e,t),(async()=>{try{await this.store._dbp}catch(e){if("SecurityError"===e.name)return null;throw e}return this})()}async get(e){const t=await function(e,t=f()){let r;return t._withIDBStore("readonly",(t=>{r=t.get(e)})).then((()=>r.result))}(e,this.store);return"string"==typeof t?t:void 0}async set(e,t){await function(e,t,r=f()){return r._withIDBStore("readwrite",(r=>{r.put(t,e)}))}(e,t,this.store)}async remove(e){await function(e,t=f()){return t._withIDBStore("readwrite",(t=>{t.delete(e)}))}(e,this.store)}}class w{constructor(e){return this.store=e,(async()=>this)()}async get(e){const t=this.store.getItem(e);return"string"==typeof t?t:void 0}async set(e,t){this.store.setItem(e,t)}async remove(e){this.store.removeItem(e)}}class y extends w{constructor(){super(window.localStorage)}}class g extends w{constructor(){super(window.sessionStorage)}}const v=void 0,S="_immortal|",b=[u],x=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}();try{x&&x.indexedDB&&b.push(m)}catch(e){}try{x&&x.localStorage&&b.push(y)}catch(e){}const E="fulfilled",D="rejected",_=e=>e;class I{constructor(e=b,t=S,r=v,o=_,n=_){this.encoder=o||_,this.decoder=n||_,this.defaultValue=r,this.keyPrefix=t??S,this.stores=[],this.onReady=(async()=>{const t=await Promise.allSettled(e.map((e=>{if("function"!=typeof e)return e;try{return new e}catch(e){return Promise.reject(e)}})));return this.stores=t.filter((e=>e.status===E)).map((e=>e.value)).filter((e=>e)),0===this.stores.length?Promise.reject(new Error("Unable to construct any store")):Promise.resolve()})()}prefix(e){return`${this.keyPrefix}${e}`}async get(r,o=this.defaultValue){await this.onReady;const n=this.prefix(r),s=await Promise.allSettled(this.stores.map((e=>e.get(n)))),i=function(e){let t=0;const r=Object.create(null);e.forEach((e=>{if(null==e)return void(t+=1);const o=r[e]||0;r[e]=o+1}));const o=Object.entries(r);return t&&o.push([void 0,t]),o}(s.filter((e=>e.status===E)).map((e=>e.value)));i.sort(((e,t)=>e[1]<=t[1]));const a=i.filter((([e])=>void 0!==e));if(0===a.length){return 0===s.filter((e=>e.status===D)).length&&await this.remove(r),o}const[c]=a[0];let u;try{u=await this.decoder(c)}catch(e){throw new t}try{await this.set(r,u)}catch(t){if(t instanceof e)throw t}return u}async set(t,r){await this.onReady;const o=this.prefix(t);let n;try{n=await this.encoder(r)}catch(t){throw new e}const s=await Promise.allSettled(this.stores.map((e=>e.set(o,n)))),i=s.filter((e=>e.status===D));if(i.length>0){const e=this.stores.length===i.length;throw new Error(`${e?"All":"Some"} stores failed to set('${t}', '${r}')`)}return r}async remove(e){await this.onReady;const t=this.prefix(e),r=await Promise.allSettled(this.stores.map((e=>e.remove(t)))),o=r.filter((e=>e.status===D));if(o.length>0){const t=this.stores.length===o.length;throw new Error(`${t?"All":"Some"} stores failed to remove('${e}')`)}return this.defaultValue}}})(),o})()));