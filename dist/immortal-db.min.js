/*! For license information please see immortal-db.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ImmortalDB=e():t.ImmortalDB=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";(function(t){function n(t){let e=0;const r=Object.create(null);t.forEach((t=>{if(null==t)return void(e+=1);const n=r[t]||0;r[t]=n+1}));const n=Object.entries(r);return e&&n.push([void 0,e]),n}function o(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return o}))}).call(this,r(2))},function(t,e,r){var n,o;!function(s){if(void 0===(o="function"==typeof(n=s)?n.call(e,r,e,t):n)||(t.exports=o),!0,t.exports=s(),!!0){var i=window.Cookies,c=window.Cookies=s();c.noConflict=function(){return window.Cookies=i,c}}}((function(){function t(){for(var t=0,e={};t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function o(){}function s(e,r,s){if("undefined"!=typeof document){"number"==typeof(s=t({path:"/"},o.defaults,s)).expires&&(s.expires=new Date(1*new Date+864e5*s.expires)),s.expires=s.expires?s.expires.toUTCString():"";try{var i=JSON.stringify(r);/^[\{\[]/.test(i)&&(r=i)}catch(t){}r=n.write?n.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var c="";for(var a in s)s[a]&&(c+="; "+a,!0!==s[a]&&(c+="="+s[a].split(";")[0]));return document.cookie=e+"="+r+c}}function i(t,r){if("undefined"!=typeof document){for(var o={},s=document.cookie?document.cookie.split("; "):[],i=0;i<s.length;i++){var c=s[i].split("="),a=c.slice(1).join("=");r||'"'!==a.charAt(0)||(a=a.slice(1,-1));try{var u=e(c[0]);if(a=(n.read||n)(a,u)||e(a),r)try{a=JSON.parse(a)}catch(t){}if(o[u]=a,t===u)break}catch(t){}}return t?o[t]:o}}return o.set=s,o.get=function(t){return i(t,!1)},o.getJSON=function(t){return i(t,!0)},o.remove=function(e,r){s(e,"",t(r,{expires:-1}))},o.defaults={},o.withConverter=r,o}((function(){}))}))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";r.r(e),r.d(e,"ImmortalDB",(function(){return P})),r.d(e,"ImmortalStorage",(function(){return j})),r.d(e,"CookieStore",(function(){return a})),r.d(e,"IndexedDbStore",(function(){return h})),r.d(e,"LocalStorageStore",(function(){return m})),r.d(e,"SessionStorageStore",(function(){return y})),r.d(e,"DEFAULT_STORES",(function(){return v})),r.d(e,"DEFAULT_KEY_PREFIX",(function(){return w}));var n=r(1),o=r.n(n);const s=function(){try{return!window.top.location.href}catch(t){return!0}}(),i=!!s,c=s?"None":"Lax";class a{constructor({ttl:t=365,secure:e=i,sameSite:r=c}={}){return this.ttl=t,this.secure=e,this.sameSite=r,(async()=>this)()}async get(t){const e=o.a.get(t);return"string"==typeof e?e:void 0}async set(t,e){o.a.set(t,e,this._constructCookieParams())}async remove(t){o.a.remove(t,this._constructCookieParams())}_constructCookieParams(){return{expires:this.ttl,secure:this.secure,sameSite:this.sameSite}}}var u=r(0);class l{constructor(t="keyval-store",e="keyval"){this.storeName=e,this._dbp=new Promise(((r,n)=>{const o=indexedDB.open(t,1);o.onerror=()=>n(o.error),o.onsuccess=()=>r(o.result),o.onupgradeneeded=()=>{o.result.createObjectStore(e)}}))}_withIDBStore(t,e){return this._dbp.then((r=>new Promise(((n,o)=>{const s=r.transaction(this.storeName,t);s.oncomplete=()=>n(),s.onabort=s.onerror=()=>o(s.error),e(s.objectStore(this.storeName))}))))}}let f;function d(){return f||(f=new l),f}class h{constructor(t="ImmortalDB",e="key-value-pairs"){return this.store=new l(t,e),(async()=>{try{await this.store._dbp}catch(t){if("SecurityError"===t.name)return null;throw t}return this})()}async get(t){const e=await function(t,e=d()){let r;return e._withIDBStore("readonly",(e=>{r=e.get(t)})).then((()=>r.result))}(t,this.store);return"string"==typeof e?e:void 0}async set(t,e){await function(t,e,r=d()){return r._withIDBStore("readwrite",(r=>{r.put(e,t)}))}(t,e,this.store)}async remove(t){await function(t,e=d()){return e._withIDBStore("readwrite",(e=>{e.delete(t)}))}(t,this.store)}}class p{constructor(t){return this.store=t,(async()=>this)()}async get(t){const e=this.store.getItem(t);return"string"==typeof e?e:void 0}async set(t,e){this.store.setItem(t,e)}async remove(t){this.store.removeItem(t)}}class m extends p{constructor(){super(window.localStorage)}}class y extends p{constructor(){super(window.sessionStorage)}}const w="_immortal|",v=[a],g=Object(u.b)();try{g&&g.indexedDB&&v.push(h)}catch(t){}try{g&&g.localStorage&&v.push(m)}catch(t){}const S="fulfilled",b="rejected",x=t=>t;class j{constructor(t=v,e=w,r,n=x,o=x){this.encoder=n||x,this.decoder=o||x,this.defaultValue=r,this.keyPrefix=e,this.stores=[],this.onReady=(async()=>{const e=await Promise.allSettled(t.map((t=>{if("function"!=typeof t)return t;try{return new t}catch(t){return Promise.reject(t)}})));return this.stores=e.filter((t=>t.status===S)).map((t=>t.value)).filter((t=>t)),0===this.stores.length?Promise.reject(new Error("Unable to construct any store")):Promise.resolve()})()}prefix(t){return`${this.keyPrefix}${t}`}async get(t,e=this.defaultValue){await this.onReady;const r=this.prefix(t),n=await Promise.allSettled(this.stores.map((t=>t.get(r).then((t=>t&&this.decoder(t)))))),o=n.filter((t=>t.status===S)).map((t=>t.value)),s=Object(u.a)(o);s.sort(((t,e)=>t[1]<=e[1]));const i=s.filter((([t])=>void 0!==t));if(0===i.length){return 0===n.filter((t=>t.status===b)).length&&await this.remove(t),e}const[c]=i[0];try{await this.set(t,c)}catch(t){}return c}async set(t,e){await this.onReady;const r=this.prefix(t),n=await Promise.resolve(this.encoder(e)),o=await Promise.allSettled(this.stores.map((t=>t.set(r,n)))),s=o.filter((t=>t.status===b));if(s.length>0){const r=this.stores.length===s.length;throw new Error(`${r?"All":"Some"} stores failed to set('${t}', '${e}')`)}return e}async remove(t){await this.onReady;const e=this.prefix(t),r=await Promise.allSettled(this.stores.map((t=>t.remove(e)))),n=r.filter((t=>t.status===b));if(n.length>0){const e=this.stores.length===n.length;throw new Error(`${e?"All":"Some"} stores failed to remove('${t}')`)}return this.defaultValue}}const P=new j}])}));